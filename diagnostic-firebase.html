<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic Firebase - DevTech</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 { color: #667eea; text-align: center; }
        h2 { color: #764ba2; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
        .config-box {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .config-box h3 { margin-top: 0; color: #667eea; }
        textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
        }
        button {
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px 5px;
            transition: all 0.3s;
        }
        button:hover { 
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .success { background: #d1fae5; color: #065f46; border-left: 5px solid #10b981; }
        .error { background: #fee2e2; color: #991b1b; border-left: 5px solid #ef4444; }
        .info { background: #dbeafe; color: #1e40af; border-left: 5px solid #3b82f6; }
        .warning { background: #fef3c7; color: #92400e; border-left: 5px solid #f59e0b; }
        .log {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .log div { margin: 5px 0; padding: 3px 0; }
        .instructions {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .instructions ol { padding-left: 25px; }
        .instructions li { margin: 10px 0; }
        code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #e11d48;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Diagnostic Firebase - DevTech V1.1</h1>
        
        <div class="instructions">
            <h3>ğŸ“‹ Instructions pour rÃ©cupÃ©rer la vraie configuration Firebase :</h3>
            <ol>
                <li>Va sur <strong>Firebase Console</strong> : <a href="https://console.firebase.google.com/" target="_blank">console.firebase.google.com</a></li>
                <li>SÃ©lectionne ton projet <strong>DevTech (devtech-20997)</strong></li>
                <li>Clique sur l'icÃ´ne <strong>âš™ï¸</strong> puis <strong>"ParamÃ¨tres du projet"</strong></li>
                <li>Descends jusqu'Ã  la section <strong>"Vos applications"</strong></li>
                <li>Clique sur <strong>"DevTech App"</strong> ou sur l'icÃ´ne <code>&lt;/&gt;</code></li>
                <li>Copie tout le contenu de <code>const firebaseConfig = {...}</code></li>
                <li>Colle-le dans le champ ci-dessous et clique sur "Tester cette configuration"</li>
            </ol>
        </div>

        <div class="config-box">
            <h3>ğŸ”‘ Configuration Firebase Actuelle (Ã  remplacer)</h3>
            <textarea id="configInput" placeholder='Colle ici la configuration complÃ¨te depuis Firebase Console, par exemple:
{
  apiKey: "AIzaSy...",
  authDomain: "devtech-20997.firebaseapp.com",
  projectId: "devtech-20997",
  storageBucket: "devtech-20997.firebasestorage.app",
  messagingSenderId: "95961701207",
  appId: "1:95961701207:web:..."
}'>{
  apiKey: "AIzaSyD2v9knFsWsOAe_eWudFVWoojylojQFgSU",
  authDomain: "devtech-20997.firebaseapp.com",
  projectId: "devtech-20997",
  storageBucket: "devtech-20997.firebasestorage.app",
  messagingSenderId: "95961701207",
  appId: "1:95961701207:web:34659317465bedf897bc12",
  measurementId: "G-D9VZ140KSF"
}</textarea>
            <button onclick="testCustomConfig()">ğŸ§ª Tester cette configuration</button>
            <button onclick="testCurrentConfig()">ğŸ”„ Re-tester la config actuelle</button>
        </div>

        <div id="status"></div>
        
        <h2>ğŸ“Š RÃ©sultats des tests</h2>
        <div id="results"></div>
        
        <h2>ğŸ“ Console de diagnostic</h2>
        <div id="logs" class="log"></div>
        
        <button onclick="clearLogs()" style="background: #64748b; margin-top: 10px;">ğŸ—‘ï¸ Effacer les logs</button>
    </div>

    <script type="module">
        // Fonction de logging avec couleurs
        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString('fr-FR', { hour12: false });
            const colors = {
                info: '#60a5fa',
                success: '#10b981',
                error: '#ef4444',
                warning: '#f59e0b'
            };
            logsDiv.innerHTML += `<div style="color: ${colors[type]}">[${timestamp}] ${message}</div>`;
            logsDiv.scrollTop = logsDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        window.clearLogs = function() {
            document.getElementById('logs').innerHTML = '';
            log('Logs effacÃ©s', 'info');
        }

        // Import Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';

        let currentAuth = null;

        log('ğŸš€ SystÃ¨me de diagnostic dÃ©marrÃ©', 'success');
        log('ğŸ“ URL actuelle: ' + window.location.href, 'info');
        log('ğŸ“ Origin: ' + window.location.origin, 'info');

        // Tester la configuration actuelle au chargement
        window.addEventListener('load', () => {
            log('ğŸ”„ Test automatique de la configuration actuelle...', 'info');
            testCurrentConfig();
        });

        // Fonction pour tester la configuration actuelle
        window.testCurrentConfig = async function() {
            const configText = document.getElementById('configInput').value;
            await testFirebaseConfig(configText, 'Configuration actuelle');
        }

        // Fonction pour tester une configuration personnalisÃ©e
        window.testCustomConfig = async function() {
            const configText = document.getElementById('configInput').value;
            if (!configText.trim()) {
                showStatus('âš ï¸ Veuillez coller une configuration Firebase dans le champ', 'warning');
                return;
            }
            await testFirebaseConfig(configText, 'Configuration personnalisÃ©e');
        }

        // Fonction principale de test
        async function testFirebaseConfig(configText, label) {
            showStatus(`ğŸ”„ Test en cours : ${label}...`, 'info');
            log(`
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`, 'info');
            log(`ğŸ§ª DÃ‰BUT DU TEST : ${label}`, 'info');
            log(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`, 'info');

            let config;
            try {
                // Parser la config (supporter avec ou sans "const firebaseConfig = ")
                let cleanConfig = configText.trim();
                cleanConfig = cleanConfig.replace(/const\s+firebaseConfig\s*=\s*/, '');
                cleanConfig = cleanConfig.replace(/;?\s*$/, '');
                
                // Remplacer les clÃ©s sans guillemets par des clÃ©s avec guillemets pour JSON.parse
                cleanConfig = cleanConfig.replace(/(\w+):/g, '"$1":');
                cleanConfig = cleanConfig.replace(/:\s*"([^"]+)"/g, ': "$1"');
                
                config = JSON.parse(cleanConfig);
                log('âœ… Configuration parsÃ©e avec succÃ¨s', 'success');
                log(`   ğŸ“¦ Project ID: ${config.projectId}`, 'info');
                log(`   ğŸ”‘ API Key: ${config.apiKey?.substring(0, 25)}...`, 'info');
                log(`   ğŸŒ Auth Domain: ${config.authDomain}`, 'info');
                
            } catch (error) {
                log('âŒ Erreur de parsing de la configuration', 'error');
                log(`   DÃ©tails: ${error.message}`, 'error');
                showStatus('âŒ Configuration invalide. VÃ©rifiez le format JSON.', 'error');
                return;
            }

            // Initialiser Firebase avec cette config
            try {
                log('ğŸ”„ Initialisation de Firebase...', 'info');
                const app = initializeApp(config, 'test-' + Date.now());
                currentAuth = getAuth(app);
                
                log('âœ… Firebase initialisÃ© avec succÃ¨s', 'success');
                log(`   ğŸ“± App name: ${app.name}`, 'success');
                
            } catch (error) {
                log('âŒ Erreur d\'initialisation Firebase', 'error');
                log(`   Code: ${error.code}`, 'error');
                log(`   Message: ${error.message}`, 'error');
                showStatus(`âŒ Erreur d'initialisation : ${error.message}`, 'error');
                return;
            }

            // Tester l'authentification
            const testEmail = `test-${Date.now()}@devtech.be`;
            const testPassword = 'TestDevTech2025!';

            log('ğŸ” Test d\'inscription avec Authentication...', 'info');
            log(`   ğŸ“§ Email test: ${testEmail}`, 'info');

            try {
                log('ğŸ“¡ Envoi de la requÃªte Ã  Firebase Auth...', 'info');
                const userCredential = await createUserWithEmailAndPassword(currentAuth, testEmail, testPassword);
                
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'success');
                log('ğŸ‰ TEST RÃ‰USSI ! Firebase fonctionne parfaitement !', 'success');
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'success');
                log(`   âœ… Utilisateur crÃ©Ã©: ${userCredential.user.email}`, 'success');
                log(`   âœ… UID: ${userCredential.user.uid}`, 'success');
                log(`   âœ… Date crÃ©ation: ${new Date(userCredential.user.metadata.creationTime).toLocaleString('fr-FR')}`, 'success');
                
                showStatus(`
                    <h3 style="color: #065f46; margin-top: 0;">ğŸ‰ SUCCÃˆS !</h3>
                    <p><strong>${label}</strong> fonctionne parfaitement !</p>
                    <p>âœ… Utilisateur de test crÃ©Ã© : ${userCredential.user.email}</p>
                    <p>âœ… UID : ${userCredential.user.uid}</p>
                    <p style="margin-top: 15px; padding: 10px; background: #d1fae5; border-radius: 5px;">
                        ğŸ’¡ <strong>Cette configuration est VALIDE.</strong><br>
                        Utilise exactement cette configuration dans tes fichiers login.html et app.html !
                    </p>
                `, 'success');
                
            } catch (error) {
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'error');
                log('âŒ TEST Ã‰CHOUÃ‰ - Erreur lors de l\'inscription', 'error');
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'error');
                log(`   âŒ Code erreur: ${error.code}`, 'error');
                log(`   âŒ Message: ${error.message}`, 'error');
                
                if (error.customData) {
                    log(`   ğŸ“‹ DonnÃ©es supplÃ©mentaires:`, 'error');
                    log(`      ${JSON.stringify(error.customData, null, 2)}`, 'error');
                }

                let suggestion = '';
                if (error.code === 'auth/api-key-not-valid.-Please-pass-a-valid-API-key.') {
                    suggestion = `
                        <h4 style="color: #991b1b;">âŒ ClÃ© API invalide</h4>
                        <p>Cette clÃ© API n'est pas reconnue par Firebase.</p>
                        <p><strong>Solutions :</strong></p>
                        <ol>
                            <li>Va sur Firebase Console et rÃ©cupÃ¨re la VRAIE configuration</li>
                            <li>Ou crÃ©e une nouvelle Web App dans Firebase</li>
                            <li>VÃ©rifie que le projet Firebase est bien actif</li>
                        </ol>
                    `;
                    log('ğŸ’¡ SOLUTION: RÃ©cupÃ¨re la vraie config depuis Firebase Console', 'warning');
                } else if (error.code === 'auth/email-already-in-use') {
                    suggestion = '<p>âœ… L\'erreur "email-already-in-use" signifie que Firebase fonctionne ! (Normal en test)</p>';
                    log('âœ… INFO: Email dÃ©jÃ  utilisÃ© = Firebase fonctionne bien', 'success');
                }
                
                showStatus(`
                    <h3 style="color: #991b1b; margin-top: 0;">âŒ Ã‰chec du test</h3>
                    <p><strong>${label}</strong> n'a pas fonctionnÃ©.</p>
                    <p>Code erreur : <code>${error.code}</code></p>
                    <p>Message : ${error.message}</p>
                    ${suggestion}
                `, 'error');
            }
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = 'status ' + type;
            statusDiv.innerHTML = message;
        }
    </script>
</body>
</html>
