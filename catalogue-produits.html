<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevTech - Catalogue Produits</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 40px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 28px;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: white;
            color: #667eea;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .page-header {
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 36px;
            color: #333;
            margin-bottom: 10px;
        }

        .page-description {
            color: #666;
            font-size: 16px;
        }

        .success-message {
            background: #d1fae5;
            color: #065f46;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            border-left: 4px solid #10b981;
        }

        .success-message.show {
            display: block;
        }

        .category-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        .category-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .category-title {
            font-size: 24px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .products-table {
            width: 100%;
            border-collapse: collapse;
        }

        .products-table thead {
            background: #f8f9fa;
        }

        .products-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }

        .products-table td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 15px;
        }

        .products-table tbody tr:hover {
            background: #f8f9ff;
        }

        .input-small {
            width: 80px;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            text-align: right;
            font-weight: 600;
            color: #667eea;
        }

        .input-small:focus {
            outline: none;
            border-color: #667eea;
        }

        .save-btn {
            background: #10b981;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            display: block;
            margin: 30px auto;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .save-btn:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }

            .products-table {
                font-size: 13px;
            }

            .products-table th,
            .products-table td {
                padding: 10px 8px;
            }

            .input-small {
                width: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>üîß Catalogue Produits</h1>
            <a href="app-complet.html" class="back-btn">‚Üê Retour</a>
        </div>
    </div>

    <div class="container">
        <div class="page-header">
            <h1 class="page-title">Catalogue de Mat√©riel √âlectrique</h1>
            <p class="page-description">Personnalisez les prix et temps d'intervention - Prix en ‚Ç¨ HT, Temps en heures</p>
        </div>

        <div class="success-message" id="success-message">
            ‚úÖ Prix et temps sauvegard√©s avec succ√®s !
        </div>

        <!-- CAT√âGORIE 1: PRISES √âLECTRIQUES -->
        <div class="category-section">
            <div class="category-header">
                <h2 class="category-title">üîå Prises √©lectriques</h2>
            </div>
            <table class="products-table">
                <thead>
                    <tr>
                        <th>R√©f√©rence</th>
                        <th>D√©signation</th>
                        <th>Marque</th>
                        <th>Prix HT (‚Ç¨)</th>
                        <th>Temps (h)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>PR-SIM-001</td>
                        <td>Prise simple 16A</td>
                        <td>Legrand</td>
                        <td><input type="number" class="input-small price-input" value="3.50" step="0.25" data-ref="PR-SIM-001"></td>
                        <td><input type="number" class="input-small temps-input" value="0.25" step="0.25" data-ref="PR-SIM-001"></td>
                    </tr>
                    <tr>
                        <td>PR-DOU-001</td>
                        <td>Prise double 16A</td>
                        <td>Legrand</td>
                        <td><input type="number" class="input-small price-input" value="5.80" step="0.25" data-ref="PR-DOU-001"></td>
                        <td><input type="number" class="input-small temps-input" value="0.3" step="0.25" data-ref="PR-DOU-001"></td>
                    </tr>
                    <tr>
                        <td>PR-TRI-001</td>
                        <td>Prise triple 16A</td>
                        <td>Legrand</td>
                        <td><input type="number" class="input-small price-input" value="8.20" step="0.25" data-ref="PR-TRI-001"></td>
                        <td><input type="number" class="input-small temps-input" value="0.4" step="0.25" data-ref="PR-TRI-001"></td>
                    </tr>
                    <tr>
                        <td>PR-USB-001</td>
                        <td>Prise avec USB</td>
                        <td>Legrand</td>
                        <td><input type="number" class="input-small price-input" value="12.50" step="0.25" data-ref="PR-USB-001"></td>
                        <td><input type="number" class="input-small temps-input" value="0.4" step="0.25" data-ref="PR-USB-001"></td>
                    </tr>
                    <tr>
                        <td>PR-SPE-001</td>
                        <td>Prise sp√©cialis√©e 20A</td>
                        <td>Schneider</td>
                        <td><input type="number" class="input-small price-input" value="8.50" step="0.25" data-ref="PR-SPE-001"></td>
                        <td><input type="number" class="input-small temps-input" value="0.5" step="0.25" data-ref="PR-SPE-001"></td>
                    </tr>
                    <tr>
                        <td>PR-SPE-002</td>
                        <td>Prise sp√©cialis√©e 32A</td>
                        <td>Schneider</td>
                        <td><input type="number" class="input-small price-input" value="15.00" step="0.25" data-ref="PR-SPE-002"></td>
                        <td><input type="number" class="input-small temps-input" value="0.6" step="0.25" data-ref="PR-SPE-002"></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- CAT√âGORIE 2: INTERRUPTEURS -->
        <div class="category-section">
            <div class="category-header">
                <h2 class="category-title">üí° Interrupteurs</h2>
            </div>
            <table class="products-table">
                <thead>
                    <tr>
                        <th>R√©f√©rence</th>
                        <th>D√©signation</th>
                        <th>Marque</th>
                        <th>Prix HT (‚Ç¨)</th>
                        <th>Temps (h)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>INT-SIM-001</td>
                        <td>Interrupteur simple</td>
                        <td>Legrand</td>
                        <td><input type="number" class="input-small price-input" value="2.80" step="0.25" data-ref="INT-SIM-001"></td>
                        <td><input type="number" class="input-small temps-input" value="0.25" step="0.25" data-ref="INT-SIM-001"></td>
                    </tr>
                    <tr>
                        <td>INT-DOU-001</td>
                        <td>Interrupteur double</td>
                        <td>Legrand</td>
                        <td><input type="number" class="input-small price-input" value="4.50" step="0.25" data-ref="INT-DOU-001"></td>
                        <td><input type="number" class="input-small temps-input" value="0.3" step="0.25" data-ref="INT-DOU-001"></td>
                    </tr>
                    <tr>
                        <td>INT-VAE-001</td>
                        <td>Interrupteur va-et-vient</td>
                        <td>Legrand</td>
                        <td><input type="number" class="input-small price-input" value="3.20" step="0.25" data-ref="INT-VAE-001"></td>
                        <td><input type="number" class="input-small temps-input" value="0.4" step="0.25" data-ref="INT-VAE-001"></td>
                    </tr>
                    <tr>
                        <td>VAR-LED-001</td>
                        <td>Variateur LED 400W</td>
                        <td>Schneider</td>
                        <td><input type="number" class="input-small price-input" value="18.50" step="0.25" data-ref="VAR-LED-001"></td>
                        <td><input type="number" class="input-small temps-input" value="0.35" step="0.25" data-ref="VAR-LED-001"></td>
                    </tr>
                    <tr>
                        <td>DET-MOU-001</td>
                        <td>D√©tecteur de mouvement</td>
                        <td>Hager</td>
                        <td><input type="number" class="input-small price-input" value="22.00" step="0.25" data-ref="DET-MOU-001"></td>
                        <td><input type="number" class="input-small temps-input" value="0.5" step="0.25" data-ref="DET-MOU-001"></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- CAT√âGORIE 3: √âCLAIRAGE -->
        <div class="category-section">
            <div class="category-header">
                <h2 class="category-title">üí° √âclairage LED</h2>
            </div>
            <table class="products-table">
                <thead>
                    <tr>
                        <th>R√©f√©rence</th>
                        <th>D√©signation</th>
                        <th>Marque</th>
                        <th>Prix HT (‚Ç¨)</th>
                        <th>Temps (h)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>LED-SP6-001</td>
                        <td>Spot LED encastrable 6W</td>
                        <td>Philips</td>
                        <td><input type="number" class="input-small price-input" value="8.50" step="0.25" data-ref="LED-SP6-001"></td>
                        <td><input type="number" class="input-small temps-input" value="0.3" step="0.25" data-ref="LED-SP6-001"></td>
                    </tr>
                    <tr>
                        <td>LED-SP10-001</td>
                        <td>Spot LED encastrable 10W</td>
                        <td>Philips</td>
                        <td><input type="number" class="input-small price-input" value="12.00" step="0.25" data-ref="LED-SP10-001"></td>
                        <td><input type="number" class="input-small temps-input" value="0.3" step="0.25" data-ref="LED-SP10-001"></td>
                    </tr>
                    <tr>
                        <td>LED-APP-001</td>
                        <td>Spot LED apparent 10W</td>
                        <td>Osram</td>
                        <td><input type="number" class="input-small price-input" value="15.00" step="0.25" data-ref="LED-APP-001"></td>
                        <td><input type="number" class="input-small temps-input" value="0.4" step="0.25" data-ref="LED-APP-001"></td>
                    </tr>
                    <tr>
                        <td>LED-REG120-001</td>
                        <td>R√©glette LED 120cm 36W</td>
                        <td>Osram</td>
                        <td><input type="number" class="input-small price-input" value="25.00" step="0.25" data-ref="LED-REG120-001"></td>
                        <td><input type="number" class="input-small temps-input" value="0.5" step="0.25" data-ref="LED-REG120-001"></td>
                    </tr>
                    <tr>
                        <td>LED-PLAF-001</td>
                        <td>Plafonnier LED 24W</td>
                        <td>Philips</td>
                        <td><input type="number" class="input-small price-input" value="35.00" step="0.25" data-ref="LED-PLAF-001"></td>
                        <td><input type="number" class="input-small temps-input" value="0.6" step="0.25" data-ref="LED-PLAF-001"></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- CAT√âGORIE 4: C√ÇBLES -->
        <div class="category-section">
            <div class="category-header">
                <h2 class="category-title">üîó C√¢bles √©lectriques</h2>
            </div>
            <table class="products-table">
                <thead>
                    <tr>
                        <th>R√©f√©rence</th>
                        <th>D√©signation</th>
                        <th>Marque</th>
                        <th>Prix HT (‚Ç¨/m)</th>
                        <th>Temps (h/m)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>CAB-XVB-1.5</td>
                        <td>C√¢ble XVB 3G1.5mm¬≤ (√©clairage)</td>
                        <td>Nexans</td>
                        <td><input type="number" class="input-small price-input" value="1.20" step="0.25" data-ref="CAB-XVB-1.5"></td>
                        <td><input type="number" class="input-small temps-input" value="0.05" step="0.25" data-ref="CAB-XVB-1.5"></td>
                    </tr>
                    <tr>
                        <td>CAB-XVB-2.5</td>
                        <td>C√¢ble XVB 3G2.5mm¬≤ (prises 16A)</td>
                        <td>Nexans</td>
                        <td><input type="number" class="input-small price-input" value="1.80" step="0.25" data-ref="CAB-XVB-2.5"></td>
                        <td><input type="number" class="input-small temps-input" value="0.05" step="0.25" data-ref="CAB-XVB-2.5"></td>
                    </tr>
                    <tr>
                        <td>CAB-XVB-4</td>
                        <td>C√¢ble XVB 3G4mm¬≤ (prises 20A)</td>
                        <td>Nexans</td>
                        <td><input type="number" class="input-small price-input" value="2.50" step="0.25" data-ref="CAB-XVB-4"></td>
                        <td><input type="number" class="input-small temps-input" value="0.06" step="0.25" data-ref="CAB-XVB-4"></td>
                    </tr>
                    <tr>
                        <td>CAB-XVB-6</td>
                        <td>C√¢ble XVB 3G6mm¬≤ (prises 32A)</td>
                        <td>Nexans</td>
                        <td><input type="number" class="input-small price-input" value="3.80" step="0.25" data-ref="CAB-XVB-6"></td>
                        <td><input type="number" class="input-small temps-input" value="0.07" step="0.25" data-ref="CAB-XVB-6"></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <button class="save-btn" onclick="saveAllPricesAndTemps()">üíæ Enregistrer tous les prix et temps</button>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAQ9YFHCYhKG-65rqJp31QEb68F9oY4HFk",
            authDomain: "devtech-20997.firebaseapp.com",
            projectId: "devtech-20997",
            storageBucket: "devtech-20997.firebasestorage.app",
            messagingSenderId: "95961701207",
            appId: "1:95961701207:web:25ac1e97f292c58797bc12",
            measurementId: "G-7S08YYT59J"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;

        onAuthStateChanged(auth, async (user) => {
            if (!user || !user.emailVerified) {
                window.location.href = 'login-v2.html';
            } else {
                currentUser = user;
                await loadUserPrices();
            }
        });

        async function loadUserPrices() {
            try {
                const pricesDoc = await getDoc(doc(db, 'user_prices', currentUser.uid));
                const tempsDoc = await getDoc(doc(db, 'user_temps', currentUser.uid));
                
                if (pricesDoc.exists()) {
                    const prices = pricesDoc.data();
                    document.querySelectorAll('.price-input').forEach(input => {
                        const ref = input.dataset.ref;
                        if (prices[ref]) {
                            input.value = prices[ref];
                        }
                    });
                }

                if (tempsDoc.exists()) {
                    const temps = tempsDoc.data();
                    document.querySelectorAll('.temps-input').forEach(input => {
                        const ref = input.dataset.ref;
                        if (temps[ref]) {
                            input.value = temps[ref];
                        }
                    });
                }
            } catch (error) {
                console.error('Erreur chargement:', error);
            }
        }

        window.saveAllPricesAndTemps = async function() {
            if (!currentUser) return;

            const allPrices = {};
            const allTemps = {};
            
            document.querySelectorAll('.price-input').forEach(input => {
                const ref = input.dataset.ref;
                allPrices[ref] = parseFloat(input.value) || 0;
            });

            document.querySelectorAll('.temps-input').forEach(input => {
                const ref = input.dataset.ref;
                allTemps[ref] = parseFloat(input.value) || 0;
            });

            try {
                await setDoc(doc(db, 'user_prices', currentUser.uid), allPrices);
                await setDoc(doc(db, 'user_temps', currentUser.uid), allTemps);
                
                const successMsg = document.getElementById('success-message');
                successMsg.classList.add('show');
                
                setTimeout(() => {
                    successMsg.classList.remove('show');
                }, 3000);
                
            } catch (error) {
                console.error('Erreur:', error);
                alert('‚ùå Erreur lors de la sauvegarde');
            }
        }
    </script>
</body>
</html>
